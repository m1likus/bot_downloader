# Bot-downloader
### Бот для скачивания видео с ютуба по video-id с использованием утилиты yt-dlp и распределением работы с помощью RabbitMQ.

## Общая идея работы бота + техническая составляющая
1. Пользователь заходит в чат с ботом, уже имея video-id или ссылку видео с Ютуба на руках. 
Бот поддерживает следующий ввод: 
- /start - Выводится сообщение c информацией про бота, а также о том, что можно ввести video-id или ссылку с Ютуба на видео. Обрабатывается хендлером message_start или с аналогичным названием и функциональностью.
-  Некоторый набор латинских букв и цифр - бот принимает подобный набор букв за vidoe-id и далее предлагает пользователю выбрать качество видео. В случае, если пользователь использовал кириллицу или другие алфавиты - вывести предупреждение о том, что бот принимает только video-id или ссылку. Если video-id нерабочий - вывести сообщение о неработоспособности токена. Проверка работоспособности video-id перекладывается на следующий этап - применение утилиты yt-dlp.
-  Ссылка с Ютуба - Принимаются ссылки вида "youtu.be" и "youtube". Бот парсит ссылку и получает с нее video-id. (TODO: подумать над тем, чтобы обработать неработающие ссылки типа "yo.tube" и тд). Обрабатывается хендлером get_token или с аналогичным названием и функциональностью.\
(UPD: также будет принимать ссылки на vk и прочие сайты с видео, посмотрю в документации какие сервисы доступны) \
State = wait_for_token

2. После ввода пользователем работающего video-id сообщение удаляется.
Бот использует утилиту yt-dlp, и получает список доступных разрешений видео и тип: со звуком/без звука.
Пользователю с помощью inline-клавиатуры предлагается выбрать сначала разрешение, а потом, если есть опции с звуком/без звука, то и тип видео (это реализуется через редактирование сообщения, а не удаление). Это обрабатывается хендлерами get_res и get_type или аналогами. \
States = {wait_for_res, wait_for_type}

3. После выбора пользователем разрешения и звука сообщение удаляется. Бот пишет: принял в работу и рассчитывает примерное время скачивание по формуле: $время = \frac {размер}{скорость\spaceскачивания}$ (если информация про скорость скачивания доступна) \
В этом сообщении будет доступна кнопка в inline-клавиатуре: "проверить статус" \
Это обрабатывается хендлером take_to_work или аналогом.
Тем временем бот с помощью RabbitMQ (я еще не смотрела его) помещает скачку в очередь работ. При освобождении воркера работа ему отдается. \
States = {in_queue, in_work}

4. После скачивания видео бот удаляет предыдущее сообщение, формирует файл и отправляет его пользователю. Его не удаляем. Обрабатывается хендлером send_video или аналогом. State обновляется на wait_for_token.

5. Пользователь может вводить новый токен.